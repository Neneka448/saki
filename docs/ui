```plaintext
本文档描述系统第二阶段（知识合成与代码集成阶段）的新增界面形态与交互逻辑。
已有的主工作台、基础卡片编辑、AI 对话面板等界面保持稳定，仅做必要扩展，不再在此赘述。

⸻

**1. 拼接工作台 (The Composer View)**

这是本阶段新增的核心界面，是一个沉浸式的“写作与整理”空间。
它采用**左右分栏**布局，视觉上类似于 IDE 的“代码 + 预览”或“资源管理器 + 编辑器”，但服务于知识合成。

*   **左栏：素材箱 (Source Panel)**
    *   **筛选器**：顶部提供一个筛选栏，用户可以快速选择“当前项目”、“特定标签”或“搜索结果”。
    *   **卡片流**：下方展示符合条件的卡片列表。卡片以“紧凑模式”渲染，只显示标题、摘要和核心标签，方便快速浏览。
    *   **交互**：卡片支持**拖拽 (Drag & Drop)**。用户按住一张卡片，将其拖向右栏，卡片会变为半透明的“幽灵态”跟随鼠标。

*   **右栏：合成文档 (Document Canvas)**
    *   这是一个标准的 Markdown 长文编辑器，但增加了对“卡片块”的特殊渲染支持。
    *   **卡片引用块**：当用户将卡片拖入此处，编辑器内不会直接粘贴纯文本，而是插入一个特殊的 UI 块（Block）。这个块显示原卡片的链接和摘要，并允许用户点击“展开”查看全文。
    *   **混合排版**：用户可以在卡片块之间自由输入文本、标题、列表。
    *   **导出**：顶部提供“导出”按钮，支持将当前文档（包含引用的卡片内容）渲染为单一的 Markdown 文件或 PDF。

⸻

**2. 增强型卡片编辑器 (Enhanced Card Editor)**

现有的卡片编辑器（包括 Quick Capture 和详情页）需要升级，以支持“代码锚点”。

*   **代码引用区**：
    *   在正文编辑器下方，新增一个“代码引用”区域。
    *   **添加方式**：提供一个“粘贴代码链接”的输入框，或者通过系统剪贴板自动识别 `vscode://` 链接。
    *   **展示形态**：添加成功后，显示为一个**代码卡片 (Code Snippet Card)**。
        *   **头部**：显示文件名、行号范围（如 `src/utils.ts : 15-28`）。
        *   **内容**：显示代码的高亮快照。
        *   **动作**：右上角提供一个“跳转”图标，点击即唤起 IDE。

⸻

**3. 关系图谱视图 (Graph View)**

在主工作台的视图切换区（原有的“时间流”旁边），新增“图谱”视图选项。

*   **局部优先**：
    *   默认不展示全图。
    *   当用户选中一张卡片时，图谱视图以该卡片为中心，呈辐射状展示其直接相连的卡片（父、子、引用）。
*   **交互设计**：
    *   **节点**：每个圆点代表一张卡片，圆点颜色对应其主标签颜色。
    *   **连线**：连线代表关系，线上的箭头表示方向。
    *   **点击**：点击周围的节点，视图中心会平滑移动到新节点，实现“顺藤摸瓜”式的浏览体验。

⸻

**4. 侧边栏升级：标签树 (Tag Tree)**

现有的侧边栏标签列表将升级为树形控件。

*   **层级渲染**：
    *   系统自动解析标签名中的 `/` 符号。例如 `Dev/Frontend/Vue` 会被渲染为三级目录。
    *   父节点（如 `Dev`）既可以包含子节点，也可以像普通标签一样包含卡片。
*   **拖拽整理**：
    *   允许用户在侧边栏直接拖拽标签来改变层级（例如把 `Vue` 拖到 `Frontend` 下面），系统自动更新所有相关卡片的标签名。

⸻

**5. 交互细节：AI 辅助合成**

在“拼接工作台”中，新增一种 AI 交互模式。

*   **多选操作**：在左栏素材箱中，用户可以勾选多张卡片。
*   **AI 浮窗**：选中后，底部出现一个悬浮操作栏，提供“总结”、“对比”、“提取共性”等快捷指令。
*   **结果插入**：AI 生成的结果会直接以“建议块”的形式出现在右栏光标处，用户点击“采纳”即变为永久文本。
```